{% load static %}
{% load auction_tag %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>View Lot</title>
    <!-- MDB icon -->
    <link rel="icon" href="img/mdb-favicon.ico" type="image/x-icon" />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <!-- Google Fonts Roboto -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap"
    />
    <!-- MDB -->
    <link rel="stylesheet" href="{% static 'css/mdb.min.css' %}" />
  </head>
  <body style="background-color:#f4f4f4;">
    <!-- Start your project here-->

    {% include 'sub/header.html' %}
    <main class="pt-5 px-2" style="padding-bottom:57px;" >
      <div class="container-fluid container-lg  mt-5  px-lg-5 bg-white rounded-5 py-1" >
        
        
        <div class="row border rounded-5 py-3 my-3" style="background-color: #faf6f6 !important">
          <div class="row">
            <div class="col-4">{% if item.user == request.user %}<a class="btn btn-link btn-rounded btn-sm fw-bold float-start" data-mdb-ripple-color="dark" href="{% url "itemEditPage" item.id %}" >Edit</a>  {% endif %}</div>
            <div class="col-md-4 justify-content-center d-flex"><b>Posted On: {{item.createdOn}}</b></div>
            <div class="col-sm-4">
              <div class="form-group" style="">
                <label class="control-label" style="font-weight:500;">Item Condition</label>
                <div class="input-group">
                  <div class="input-group-prepend" style="background-color: #e9ecef;">
                    <span class="input-group-text"><i class="fas fa-wrench"></i></span>
                  </div>
                  <div class="form-control input text-right">{{item.condition}}</div>
                </div>
              </div>

            </div>
            <div class="col-12 h-15">
              <div class="row">
                <div class="col-8">
                  <h3>{{item.name}}</h3>
                </div>
                <div class="col-4 d-flex align-items-center justify-content-end">
                  <div class="bg-success text-center p-0" style="border-radius: 0.5rem;color: #fff; font-size: small; width: 130px; background-color:{{item.status.backgroundColor}} !important">{{item.status.name}}</div>
                </div>
              </div>
            </div> 
          </div>
          <div class="col-12">
            <hr>
          </div>
          <div class="col-md-6 col-sm-12 ">
            <div class="row">
              <div class="col-12">
                <img
                  src="https://mdbcdn.b-cdn.net/img/new/standard/city/041.webp"
                  class="img-thumbnail"
                  alt="Hollywood Sign on The Hill"
                  style="min-height: 157px;"
                />
              </div>
              <div class="col-12">
                {% if item.user != request.user %}
                <div class="alert alert-info" style="padding: 8px 12px">
                  <a class="btn d-block btn-outline-secondary" data-mdb-ripple-color="dark" href="
                  {% if message.item.user != request.user %}
                    {% url 'messageChatPage' item.id %}
                  {% endif %}" role="button"> CHAT</a>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
          <div class="col-md-6 col-sm-12 " style="min-height:258px">
            <div class="row h-100">
              <div class="col-12 h-25">
                <div class="row">
                  <div class="col-12 d-flex align-items-center justify-content-end" style="height: 43px;">
                    <div class="text-center p-0" style="border-radius: 0.5rem;color: #fff; font-size: small; width: 86px;background-color: #aeb1b4;">{{item.tag}}</div>
                  </div>
                  <div class="col-6">
                    <div class="form-group" style="">
                      <label class="control-label" style="font-weight:500;">Bids</label>
                      <div class="input-group">
                        <div class="input-group-prepend" style="background-color: #e9ecef;">
                          <span class="input-group-text"><i class="fas fa-hashtag"></i></span>
                        </div>
                        <div class="form-control input text-right">{{item.bids}}</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="form-group" style="">
                      <label class="control-label" style="font-weight:500;">Current price</label>
                      <div class="input-group">
                        <div class="input-group-prepend" style="background-color: #e9ecef;">
                          <span class="input-group-text"><b>ETB</b></span>
                        </div>
                        <div class="form-control input text-right">{{item.current_price}}</div>
                      </div>
                    </div>
                  </div>
                </div>
                <form action = "" method = "post">
                  {% csrf_token %}
                  
                  <div class="row">
                    <div class="col-12">
                      <hr>
                    </div>
                    <div class="col-6">
                      <div class="form-group" style="">
                        <label class="control-label" style="font-weight:500;">Minimum increase</label>
                        <div class="input-group">
                          <div class="input-group-prepend" style="background-color: #e9ecef;">
                            <span class="input-group-text"><b>ETB</b></span>
                          </div>
                          <div class="form-control input text-right">{{item.min_increase_price}}</div>
                        </div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="form-group" style="">
                        <label class="control-label" style="font-weight:500;">Maximum increase</label>
                        <div class="input-group">
                          <div class="input-group-prepend" style="background-color: #e9ecef;">
                            <span class="input-group-text"><b>ETB</b></span>
                          </div>
                          <div class="form-control input text-right">{{item.max_increase_price}}</div>
                        </div>
                      </div>
                    </div>
                    <div class="col-12">
                      <hr>
                    </div>
                    <div class="col-6">
                      <div class="form-group" style="">
                        <label class="control-label" style="font-weight:500;">Your Rank</label>
                        <div class="input-group">
                          <div class="input-group-prepend" style="background-color: #e9ecef;">
                            <span class="input-group-text"><i class="fas fa-hashtag"></i></span>
                          </div>
                          <div class="form-control input text-right">
                            {{ item|my_rank:request.user }} 
                            {% if item|my_rank:request.user == 1 %}
                             - Winning
                             {% elif item|my_rank:request.user > 1 %}
                             - Loosing
                             {% endif %}
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="form-group" style="">
                        <label class="control-label" style="font-weight:500;">Your Last Price</label>
                        <div class="input-group">
                          <div class="input-group-prepend" style="background-color: #e9ecef;">
                            <span class="input-group-text"><b>ETB</b></span>
                          </div>
                          <div class="form-control input text-right">{{ item|my_last_price:request.user }}</div>
                        </div>
                      </div>
                    </div>
                    <div class="col-12">
                      <hr>
                    </div>
                    {% if item.user != request.user and item.status.name == 'Active' %}
                    <div class="col-12">
                      <label class="control-label" style="font-weight:500;">Your New Price</label>
                      <div class="form-group" style="">
                        <div class="input-group">
                          <div class="input-group-prepend" style="background-color: #e9ecef;">
                            <span class="input-group-text"><b>ETB</b></span>
                          </div>
                          {% comment %} <div class="form-control input text-right"><input type="number" ></div> {% endcomment %}
                          <div class="form-outline">
                            {{itemBidForm.price_input}}
                          </div>
                        </div>
                      </div>
                      <div class="mb-2 text-start text-danger" id="price_input_error"></div>
                      <hr>
                      <div class="d-grid gap-2" style="margin-bottom: 11px;">
                        <input type="submit" onclick="price_input_error_fun()" class="btn btn-primary w-100" value="Process Bid">
                      </div>
                    </div>
                    {% endif %}
                  </div>
                </form>
              </div>
            </div>
          </div>
          <hr>
          <div class="form-group" style="width: 100%%;height: 130px;">
            <label class="control-label" style="font-weight:500;">Description</label>
            <div class="input-group h-100" style="max-height:117px;">
              <div class="input-group-prepend" style="background-color: #e9ecef;height:105px;">
                <span class="input-group-text " style="height: 105px" ><i class="fas fa-circle-info"></i></span>
              </div>
              <div class="form-control input text-right" style="height: 105px; max-height: 117px; overflow-y: auto;">{{item.description}}</div>
            </div>
          </div>

          {% if item.user == request.user %}
          <div class="col">
            <table class="table table-responsive d-md-table d-block table-sm table-bordered bg-white table-striped caption-top text-nowrap ">
              <caption>
                List of Bids
              </caption>
              <thead>
                <tr>
                  <th scope="col">Bid ID</th>
                  <th scope="col">Rank</th>
                  <th scope="col">User Name</th>
                  <th scope="col">Full Name</th>
                  <th scope="col">email</th>
                  <th scope="col">Price</th>
                  <th scope="col">Phone</th>
                </tr>
              </thead>
              <tbody>
                {% for bidPrice in page_obj %}
                <tr>
                  <td>B-{{bidPrice.id|default_if_none:""}}</th>
                  <td>{{ bidPrice.item|my_rank:bidPrice.user }}</td>
                  <td>{{bidPrice.user.username|default_if_none:""}}</td>
                  <td>{{bidPrice.user.first_name|default_if_none:""}} {{bidPrice.user.last_name|default_if_none:""}}</td>
                  <td>{{bidPrice.user.email|default_if_none:""}}</td>
                  <td>{{bidPrice.price|default_if_none:""}}</td>
                  <td>{{bidPrice.user.userdetail.phone|default_if_none:""}}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            <div class="">
              <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    
                  <li class="page-item d-sm-block d-none {% if not page_obj.has_previous %} disabled {% endif %}">
                      <a class="page-link" href="?page=1">&laquo; First</a>
                  </li>
                  <li class="page-item {% if not page_obj.has_previous %} disabled {% endif %}">
                      <a class="page-link" href="{% if page_obj.has_previous %} ?page={{ page_obj.previous_page_number }} {% endif %}">Previous</a>
                  </li>
                  
                  <select class="form-control form-select" style="width: 73px;" onchange="location = '?page=' + this.value;">
                    {% for page_no in total_page %}
                    <option value="{{page_no}}" {% if page_no == page_obj.number %}selected{% endif %}>{{page_no}}</option>
                    {% endfor %}
                   </select>
                  
                  <li class="page-item {% if not page_obj.has_next %} disabled {% endif %}">
                      <a class="page-link" href="{% if page_obj.has_next %} ?page={{ page_obj.next_page_number }} {% endif %}">Next</a>
                  </li>
                  <li class="page-item d-sm-block d-none {% if not page_obj.has_next %} disabled {% endif %}">
                      <a class="page-link" href="{% if page_obj.has_next %} ?page={{ page_obj.paginator.num_pages }} {% endif %}">Last &raquo;</a>
                  </li>
                  
                </ul>
              </nav>
            </div>
          </div>
          {% endif %}
        </div>










      </div>
    </main>
    <!-- End your project here-->

    <!-- MDB -->
    <script type="text/javascript" src="{% static 'js/mdb.min.js' %}"></script>
    <!-- Custom scripts -->
    <script>
      function price_input_error_fun() {
        const price_input = document.getElementById("id_itemBidForm-price_input");
        if (!price_input.checkValidity()) {
          document.getElementById("price_input_error").innerHTML = price_input.validationMessage;
        } else {
          document.getElementById("price_input_error").innerHTML = ""
        } 
      } 
    </script>
    <script type="text/javascript"></script>
    {% include 'sub/footer.html' %}
  </body>
</html>
